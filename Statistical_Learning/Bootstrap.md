删失数据的重抽样
================

假设 $Y^0$是非负的死亡时间，C是删失值,我们主要研究的随机变量
$Y=min(Y^0,C)$. 我们观测到的数据类型是$(Y,D)$,
$D=1$表示数据是未删失的，$D=0$表示数据是删失的.

首先我们进行一些定义.

-   生存函数为 $Pr(Y^0>y)=1-F^0(y)$,

-   累积风险函数为 $A^0(y)=-\log \{1-F^0(y) \}$, 也可以写成
    $\int_0^y dA^0(y)$.

-   风险函数为 $dA^0(y)/dy$ 表示给定存活到 $y$时候，在$y$时刻的死亡风险.

下面,我们考虑对生存函数，累积风险函数，删失函数的估计.

-   对于生存函数的一种估计是 $Kaplan-Meier$估计:
    $$1-\hat{F}^0(y)=\prod_{j:y_j\le y} (\frac{n-j}{n+1-j})^{d_j} .$$

-   $1-\hat{F}^0(y)$的标准误为
    $$(1-\hat{F}^0(y)) (\sum_{j:y_j\le y} (\frac{d_j}{(n-j)(n-j+1)})^{1/2}).$$

-   对删失生存函数的PL估计为
    $$1-\hat{G}(y)=\prod_{j:y_j \le y} (\frac{n-j}{n+1-j})^{1-d_j}.$$

-   累积风险函数用 $Nelson-Aelen$方法估计
    $$\hat{A}^0(y)=\sum_{j:y_j \le y} \frac{d_j}{\sum_{k=1}^n H(y_j-y_k)}.$$

接下来, 我们考虑在删失数据下的boostrap方法.

-   普通Boostrap:

    令 $Y^*=\min(Y^{0*},C^*)$,$Y^{0*},C^{0*}$分别独立产生于
    $\hat{F}^0,\hat{G}^0$, 则
    $$Pr(Y>y)=(1-F^0(y))(1-G(y))=\prod_{j:y_j\le y} (\frac{n-j}{n+1-d}).$$

-   条件Boostrap:

    1.  从 $\hat{F}^0$中独立抽取 $Y_1^{0*},\dots,Y_n^{0*}$;

    2.  对于 $j=1,\dots,n$, 如果$d_j=0$,则 $C_j^{*}=y_j$, 若$d_j=1$,
        则我们知道 $c_j > y_j$,
        我们从条件分布$\frac{\hat{G}(y)-\hat{G}(y_j)}{1-\hat{G}(y_j)}$中抽取
        $C_j^{*}$.

    3.  令 $Y_j^{*}=\min(Y_j^{0*},C_j^{*})$.

-   Weird Bootstrap:

    前面两种方法都是关注的是每个个体的失败和删失时间,
    如果我们关注的是生存函数或者风险函数，Weird Boostrap方法就比较适用.

    主要思想是将任意时间$y_j$的死亡人数$N_j$,
    看做独立的伯努利随机变量，$N_j \sim B(n-j+1,d_j/(n-j+1))$,然后我们考虑对$N_j$进行抽样得到
    $N_j^{*}$，则模拟产生的$Nelsen-Aalen$估计就是
    $$\hat{A}^{0*}(y)=\sum_{i=1}^n \frac{N_j^{*}}{\sum_{k=1}^n H(y_j-y_k)}.$$

缺失数据的重抽样
================

这一节我们讨论缺失数据，而不是类似于前一节的删失数据.参数模型下的缺失数据可以考虑用EM算法来解决，但这不是我们这一节要讨论的问题，我们这里主要讨论非参数模型下的重抽样方法.

假设随机变量
$Y^0$被观测了$n$次，但是其中的$m$次观测丢失了,我们观测到的数据为:
$$y_1,\dots,y_n=y_1^0,\dots,y_{n-m}^0,NA,\dots,NA$$.
如果我们想要估计总体均值$\mu$,我们自然地用$t=\bar{y}$,这里用的是未缺失的样本均值,我们考虑非参数的Boostrap抽样:

-   方法一:

    1.  有放回地从
        $y_1,\dots,y_n=y_1^0,\dots,y_{n-m}^0,NA,\dots,NA$里面抽出
        $y_1^*,\dots,y_n^*$.

    2.  $t^*$为未缺失的数据的均值.

    这种方法的一个主要问题是缺失的个数是随机的，记为$M^{*}$,均值是$m$.
    这样会导致方程$T^{*}$会比 $T$的方差要大,
    $Var^{*}(T^{*})=(n-m)vE(\frac{1}{n-M^{*}})>v$.方法一的改进是将数据分层.
    其实这种方法就等同于直接丢弃缺失值.

-   方法二:

    1.  用未缺失的样本均值来代替缺失数据,$\hat{y_j}^0=\bar{y},j=n-m+1,\dots,n$

    2.  有放回地从替换之后的样本$y_1,\dots,y_n$中进行抽样，得到$y_1^{*},\dots,y_n^{*}$;

    3.  随机选取 $m$ 个标记为$NA$.

    4.  再用未缺失的样本均值计算 $t^{*}$.

    方法二的问题是将数据向中心位置集中了,$Var^{*}(T^{*})=\frac{n-m}{m} v$,
    一个改进的办法是将简单的估计$\hat{y_j}^0=\bar{y}$扩展为
    $\bar{y}+e_1,\dots,\bar{y}+e_{n-m}$,但是这样本来是一个数据，现在扩展成了$n-m$个，所以我们要给他权重为
    $1/(n-m)$.
    在这个简单的问题里面$e_j=y_j-\bar{y}$,当然我们也可以加其他扰动.

有限样本下的重抽样
==================

背景
----

假设样本$y_1,\dots,y_n$是从总体$\mathcal{Y}_1,\dots,\mathcal{Y}_N$
中无放回选取的,$N>n$. 一般地,
我们用统计量$t(y_1,\dots,y_n)$来估计相应的总体参数$\theta=t(\mathcal{Y}_1,\dots,\mathcal{Y}_N)$.
样本比例被定义为$f=n/N$.由于数据不是$i.i.d.$的,
样本之间的相关性会影响重抽样的步骤.因此我们考虑有限样本的重抽样的方法.

Modified sample size
--------------------

-   有放回的抽样.

    从$y_1,\dots,y_n$有放回的抽取样本$Y_1^{*},\dots,Y_{n^{'}}^{*}$,
    重复这个过程$R$次.

-   无放回抽样.

    从 $y_1,\dots,y_n$ 中无放回抽取$Y_1^{*},\dots,Y_{n^{'}}^{*}$.
    重抽样的样本量 $n^{'}=nf$. 重复这个过程$R$次. 当
    $f \ll 1$,重抽样的样本量远小于 $n$, 重抽样的统计量会不稳定.

-   Minnor-match 重抽样.

    假设$m=nf,k=n/m$都是整数. 从$y_1,\dots,y_n$无放回抽取 $m$个样本,
    重复这个过程$k$次.将这些样本合成一个bootstrap样本.
    因此，重抽样的样本量是 $n^{'}=mk$. 如果$m,k$
    不是整数的话，就可以做一些小的调整.

Population and Subpopulation
----------------------------

Population 和 subpopulation 重抽样是建立一个伪总体,伪总体的样本量是 $N$.
然后从伪总体中无放回地抽取我们的boostrap样本 $(Y_1^{*},\dots,Y_n^{*})$.
两周的不同在于重新伪总体的方式不同.

-   Population 重抽样.

    我们将$y_1,\dots,y_n$重复 $N/n$次, 得到伪总体$\mathcal{Y}^{*}$.

-   Subpopulation 重抽样.

    从 $y_1,\dots,y_n$中有放回地重复 $N$次抽样, 得到伪总体
    $\mathcal{Y}^{*}$.

分层抽样
--------

总体被分为 $k$层, 第$i$层总体的样本量是 $N_i$,
我们独立地从每层分别无放回地抽取 $n_i$个样本. 第$i$层的抽样比为
$f_i=n_i/N_i$, 第$i$层的权重为 $w_i=N_i/N$, 这里$N=N_1+\dots, N_k$.
分层数据的Bootstrap的思路就是我们独立地对每层进行Boostrap,
然后将这些boostrap样本合并，就是我们整个的boostrap样本了.
当然，在每层的boostrap样本抽取中，之前的有限总体抽样的几种策略就可以使用了.

Hierarchical数据的重抽样
========================

最基础的 Hierarchical数据可以有如下的表示:
$$y_{ij}=x_i+z_{ij},\quad, i=1,\dots,a,j=1,\dots,b.$$ 这里 $x_i$
是从一个分布
$F_x$中随机抽取的,$z_{ij}$是随机从一个分布$F_z$中抽取的，要求 $E(Z)=0$.

这样的数据的非参数重抽样可以分为两部来做:

-   : 我们从 $a$个组中, 有放回地抽取$a$个组.

-   : 对于我们每个抽到的组, 我们对组中的元素进行重抽样，有两种策略,
    一种是无放回抽样(策略1）,另一种是有放回抽样(策略2).

通过一些计算,可以说明策略1抽取的数据的方差比较小，因此我们更愿意用策略1进行抽样.

但是,
上述方法只能用于平衡数据的抽样,无法应用到更复杂的情况，因为对于非平衡数据来说，采取上述策略进行boostrap抽样会导致重抽样的样本的容量不一样.
因为 $y_{ij}=x_i+z_{ij}$, 因此我们可以考虑分别对
$x$和$z$进行重抽样.定义:
$$\hat{x_i}=\bar{y}_i, \quad \hat{z}_{ij}=y_{ij}-\bar{y}_i.$$
我们可以考虑用以下步骤进行重抽样得到boostrap样本:

1.  从$\hat{x}_1,\dots,\hat{x}_a$有放回的随机抽取
    $x_1^{*},\dots,x_a^{*}$;

2.  从$\hat{z}_{11},\dots,\hat{z}_{ab}$中有放回地随机抽取
    $ab$次，得到$z_{11}^{*},z_{ab}^{*}$;

3.  令 $y_{ij}^{*}=x_i^{*}+z_{ij}^{*}$
